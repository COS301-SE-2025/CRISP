{% extends 'base.html' %}

{% block title %}Dashboard - CRISP Threat Intelligence{% endblock %}

{% block content %}
<h2>📊 Dashboard</h2>

{% if organization %}
<div style="background: #3498db; color: white; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
    <h3>🏢 {{ organization.name }}</h3>
    <p>{{ organization.description|default:"No description available" }}</p>
    {% if organization.contact_email %}
    <p>📧 {{ organization.contact_email }}</p>
    {% endif %}
</div>
{% endif %}

<h3>📈 Platform Statistics</h3>
<div class="stats">
    <div class="stat-card">
        <div class="stat-value">{{ stats.organizations }}</div>
        <div>Organizations</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.collections }}</div>
        <div>Collections</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.feeds }}</div>
        <div>Active Feeds</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.stix_objects }}</div>
        <div>STIX Objects</div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
    <div>
        <h3>🔄 Recent STIX Objects</h3>
        {% for obj in recent_objects %}
        <div style="background: #ecf0f1; padding: 10px; margin-bottom: 10px; border-radius: 3px;">
            <strong>{{ obj.stix_type|capfirst }}</strong> - {{ obj.stix_id|truncatechars:50 }}
            <br><small>From: {{ obj.source_organization.name }} | {{ obj.created_at|date:"M d, Y H:i" }}</small>
        </div>
        {% empty %}
        <p>No STIX objects found.</p>
        {% endfor %}
    </div>
    
    <div>
        <h3>📡 Recent Feed Activity</h3>
        {% for feed in recent_feeds %}
        <div style="background: #e8f8f5; padding: 10px; margin-bottom: 10px; border-radius: 3px;">
            <strong>{{ feed.name }}</strong>
            <br><small>Status: {{ feed.status|capfirst }} | Published: {{ feed.last_published_time|date:"M d, Y H:i"|default:"Never" }}</small>
        </div>
        {% empty %}
        <p>No feed activity found.</p>
        {% endfor %}
    </div>
</div>

<h3>🔧 Quick Actions</h3>
<div style="margin-top: 20px;">
    <a href="/admin/crisp_threat_intel/collection/" style="background: #3498db; color: white; padding: 10px 15px; text-decoration: none; margin-right: 10px; border-radius: 3px;">Manage Collections</a>
    <a href="/admin/crisp_threat_intel/feed/" style="background: #27ae60; color: white; padding: 10px 15px; text-decoration: none; margin-right: 10px; border-radius: 3px;">Manage Feeds</a>
    <a href="/taxii2/collections/" style="background: #e74c3c; color: white; padding: 10px 15px; text-decoration: none; border-radius: 3px;">TAXII Collections</a>
</div>
{% endblock %}